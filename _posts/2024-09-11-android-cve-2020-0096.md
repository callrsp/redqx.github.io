---
layout: post
title:  "CVE-2020-0096-钓鱼漏洞复现"
date:   2024-09-11 12:00:00 +0800
categories: [app-bugs-discovery] 
---



# strandhogg1.0

原文章： [StrandHogg漏洞复现及原理分析](https://www.cnblogs.com/aldys4/p/14879604.html)

ps： 这不像是漏洞，更像是一个钓鱼。

![image-20240912224054788](https://raw.githubusercontent.com/redqx/redqx.github.io/master/_posts/img/image-20240912224054788.png)

**StrandHogg漏洞**

CVE编号:至本文编写完毕时仍暂无编号

**[漏洞危害]**

近日,Android平台上发现了一个高危漏洞
该漏洞允许攻击者冒充任意合法应用,诱导受害者授予恶意应用权限
或者进行恶意钓鱼攻击
由于该漏洞允许恶意软件劫持合法应用的活动,并将自身恶意活动插入在合法活动之前
使得用户并没有意识到自己已经遭到攻击

**[漏洞影响Android版本]**

至2020年1月26日,经过测试,**该漏洞影响Android全版本,包括目前最新的Android10**

**[漏洞利用条件]**

几乎无条件即可利用此漏洞,即使在**无Root机型**上利用此漏洞也轻而易举
目前已发现36个应用恶意利用该漏洞进行攻击

## 漏洞复现

把项目给下载下来,然后使用 Android studio 编译安装 apk.

[StrandHogg.zip](https://pan.baidu.com/s/1rhiyiWxmVQeOSvEl06fBiQ) 提取码: hci6



StrandHogg项目代码介绍:

```
.
├── AndroidManifest.xml
├── java
│   └── com
│       └── vuln
│           └── strandhogg
│               ├── Attack.java
│               ├── CircleImageView.java //图形化相关
│               ├── MainActivity.java
│               └── NormalActivity.java
└── res
    ├── layout
    │   ├── activity_main.xml 对应=> NormalActivity.java
    │   └── attack_fishing.xml 对应=> Attack.java
```

NormalActivity.java 的没啥功能,就显示一个textview

Attack.java: 一个模拟qq登录界面的activity,很简陋,简陋得一眼就可以看出不是qq登录的原始界面,当用户输入账户和密码,Attack.java会显示一下

MainActivity.java: 创建2个activity, `startActivities(new Intent[]{attack,innocent});` 然后结束当前activity.



假设我们要钓鱼的是QQ,在 AndroidManifest.xml中配置一下

```xml
<activity android:name=".Attack"
    android:taskAffinity="com.tencent.mobileqq"
    android:allowTaskReparenting="true" />
```



我们先点击app: StrandHogg, 然后再点击app: QQ, 就可以实现界面的劫持



![dmeo](https://raw.githubusercontent.com/redqx/redqx.github.io/master/_posts/img/Record_2024-09-12-22-31-53.gif)

## 漏洞原理分析

深入就看不懂了...QAQ

起主要作用的是下面的代码

```xml
<activity android:name=".Attack"
    android:taskAffinity="com.tencent.mobileqq"
    android:allowTaskReparenting="true" />
```



启动模式会导致一个应用中可能不止一个任务栈，单独一个activity可以独享一个任务栈。

一个任务栈中的activity可以来自不同的应用，同一个应用的activity也可能不在一个Task中。





`android:taskAffinity`：

定义当前该Activity想要关联的任务栈。比如我们想要关联`com.tencent.mobileqq`的任务栈

`android:allowTaskReparenting="true"`：

允许该Activity在运行时从当前任务栈移到其他与`taskAffinity`匹配的任务栈。

允许当前activity的任务栈移到`com.tencent.mobileqq`





```
点击QQ前
PBCM10:/ $ dumpsys activity top | grep ACTIVITY
  ACTIVITY com.oppo.launcher/.Launcher 937943a pid=3396
  ACTIVITY com.vuln.strandhogg/.Attack d051308 pid=(not running)
  ACTIVITY com.vuln.strandhogg/.NormalActivity a5c57b4 pid=29628

点击QQ后（感觉QQ就没启动）
PBCM10:/ $ dumpsys activity top | grep ACTIVITY
  ACTIVITY com.vuln.strandhogg/.NormalActivity a5c57b4 pid=29628
  ACTIVITY com.oppo.launcher/.Launcher 937943a pid=3396
  ACTIVITY com.vuln.strandhogg/.Attack d051308 pid=29628
```



# strandhogg2.0（CVE-2020-0096）



## 前言

strandhogg2.0和strandhogg1.0均为同一家公司promo披露，相比strandhogg1.0必须明确地将他们的目标应用程序硬编码到 Android Manifest，

strandhogg2.0并不需要在`androidmanifest.xml`上进行设计，而是在代码中实现，如有需要可以动态修改注入的应用程序，也可以同时对多个程序进行劫持。

影响范围为android8和andorid9。

## 漏洞原理

这个漏洞主要是利用startActivities这个api，它的功能是一次启动多个Activity，传入一个Intent数组，Android会解析每个Intent，并逐个启动它们。startActivities默认认为intent数组的第一个Activity的启动者是当前应用，而第二个Activity的启动者是第一个Activity所属的那个应用，依次类推，

那么我们只要控制将第一个activity的所有者设为我们所要攻击的victim应用，那么就可以让我们的hackactivity被victim应用启动，就可以实现了activity劫持。